<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobiles</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <style>
        body{
            background-color: #6C7A89;
        }
        .navbar .navbar-nav .nav-link:hover{
            background-color: #A9A9A9;
            
        }
        table{
            border-radius: 24px;
        }
       
        h3{
            font-family: 'DynaPuff', cursive;
            color:white;
            text-align: center;
        }
        .error {
            position: absolute;
            top: -110%;
            left: 31%;
            padding: 1% 20%;
            border-radius: 3px;
            background-color: white;
            color: black;
            display: none;
        }
        .error::before {
            content: "";
            width: 0;
            height: 0;
            border-left: 9px solid transparent;
            border-right: 9px solid transparent;
            border-top: 9px solid #FDCAC4;
            position: absolute;
            bottom: -21%;
            left: 10%;
        }

        .error:nth-child(2) {
            top: 70px;
            background-color: #D9F0FD;
        }
        .error:nth-child(2)::before {
            border-top: 9px solid #D9F0FD;
        }

        .error:nth-child(3) {

            top: 140px;

            padding: 1% 18%;

            background-color: #6DFFA7;

        }

        .error:nth-child(3)::before {
            border-top: 9px solid #6DFFA7;
        }
       .error:nth-child(4) {
            top: 210px;
            background-color: #ffd866;
        }
        .error:nth-child(4)::before {
            border-top: 9px solid #ffd866;

        }
    </style> 
    </head>
    <body>

        <nav class="navbar navbar-expand-lg shadow-sm navbar-light bg-white fixed-top" >
            <a class="navbar-brand" href="#">
                <img src="qyrus.png" width="100px">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav ml-auto">
                <li class="nav-item ">
                  <a class="nav-link text-body" href="server.html">Server</a>
                </li>
                <li class="nav-item ">
                  <a class="nav-link text-body" href="mobiles.html">Mobiles</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link text-body" href="accessories.html">Accessories</a>
                </li>      
              </ul>
            </div>
          </nav>
          <br>
          <br>
          
          
       
        <div class="container mt-5 p-2">
        <div class="row">
            <div class="col-md-4">
                <form>
                <div class="card">
                    <div class="card-header">
                        <h4 class="text-center">Add Mobile</h4>
                    </div>
                    <div class="card-body">
                <div class="form-group">
                    <label for="">Enter CurrentClient</label>
                    <input type="text" class="form-control" placeholder="Enter CurrentClient" id="client" required>
                </div> 
                <div class="form-group">
                    <label for="">Enter Date of Purchase</label>
                    <input type="datetime-local" class="form-control" placeholder="YYYY-MM-DD" id="date" required>
                </div> 
                <div class="form-group">
                    <div class="col-md-13 ">
                        <div id="validate">
                    <label for="">Enter IP</label>
                    <label for="Tooltips" class="error"></label>
                    <input type="text" id="ip" placeholder="0.0.0.0" class="form-control">
                    </div>
                    </div>
                    
                </div> 
                <div class="form-group">
                    <label for="">Enter Location</label>
                    <select name="location" class="form-control" placeholder="Enter Location" id="location" required>
                    
                        <option value="UK">UK</option>
                        <option value="US">US</option>
                         <option value="India">India</option>
                    </select>
                </div>         
                <div class="form-group">
                    <label for="">Enter Manufacturer</label>
                    <input type="text" class="form-control" placeholder="manufacturer" id="manufacturer" required>
                </div> 
                <div class="form-group">
                    <label for="">Enter Model</label>
                    <input type="text" class="form-control" placeholder="Enter Model" id="model" required>
                </div>       
                <div class="form-group">
                    <label for="">Enter OS</label>
                    <select name="os" class="form-control" placeholder="Enter OS" id="os" required>
                        <option value="android">Android</option>
                        <option value="ios">iOS</option>
                         
                    </select>
                </div>     
                <div class="form-group">
                    <label for="">Enter SIM Card</label>
                    <input type="text" class="form-control" placeholder="Enter PhoneNumber" id="phone" required maxlength="10">
                </div> 
                <div class="form-group">
                    <label for="">Enter SerialNumber</label>
                    <input type="text" class="form-control" placeholder="Enter SerielNumber" id="seriel" required>
                </div> 
                <div class="form-group">
                    <label for="">Enter server</label>
                    <select name="server" class="form-control" placeholder="Enter Server" id="server" required>
                    
                        <option value="dell">Dell Server</option>
                        <option value="Mac-Mini">MAC-MINI</option>
                         
                    </select>
                </div> 
                <div class="form-group">
                    <label for="status">Enter Status</label>
                    <select name="status" class="form-control" placeholder="Enter Status" id="status" required>
                    
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                         <option value="damaged">Damaged</option>
                    </select>
                </div> 
                <div class="form-group">
                    <label for="">Enter OS Version</label>
                    <input type="text" class="form-control" placeholder="Enter OS Version" id="type" required>
                </div> 
                <div class="mt-3">
                    <button class="btn btn-primary float-right" onclick="submitForm();">submit</button>
                </div>
                
                <!--<div class="w-100">
                    <span id="message" class="text-success"></span>
                </div>-->
            </div>
        </div>
    </form>
            
    </div>
            <div class="col-md-4">
                <h3 class="fs-4 mb-3">Existing Mobiles</h3>
                    <input class="form-control" id="myInput" type="text" placeholder="Search..">
                    <br>
                    <table class="table bg-white rounded shadow-sm table-hover">
                    <thead>
                        <tr>
                        <th scope="col">UUID</th>
                        <th scope="col">CurrentClient</th>
                        <th scope="col">DateofPurchase</th>
                        <th scope="col">IP</th>
                        <th scope="col">Location</th>
                        <th scope="col">Manufacturer</th>
                        <th scope="col">Model</th>
                        <th scope="col">OS</th>
                        <th scope="col">SIM Card</th>
                        <th scope="col">SerielNumber</th>
                        <th scope="col">Server</th>
                        <th scope="col">Status</th>
                        <th scope="col">OSVersion</th>
                        <th scope="col">Edit</th>
                        <th scope="col">Delete</th>
                    </tr> 
                    </thead>
                    <tbody id="tbData">

                    </tbody>
                </table>

            </div>

            </div>
        </div>
        <script>
            //function myFunction1(){
                //alert('Successfully Done !!!');
            //}
            function validateIp(eVal) {
            var val = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
            if (val.test(eVal)) {
                return true;
            } else {
                return false;
            }
         }

$(document).ready(function(){
  $("#myInput").on("keyup", function() {
    var value = $(this).val().toUpperCase();
    $("#tbData tr").filter(function() {
      $(this).toggle($(this).text().toUpperCase().indexOf(value) > -1)
    });
  });
  $('#ip').on('focusout', function () {
                if ($('#ip').val() != "") {
                    if (validateIp($('#ip').val())) {
                        $('.error').fadeOut('slow');
                    } else {
                        $('.error').text('Invalid IP!');
                        $('.error').fadeIn('slow');
                     }
                } else {
                    $('.error').text('IP Required..!');
                    $('.error').fadeIn("slow");
                 }
            });
        });

//edit mobiles
var editFormData;
            function getFormData(){
                return{
                    client:document.getElementById("client").value,
                    date:document.getElementById("date").value,
                    ip:document.getElementById("ip").value,
                    location:document.getElementById("location").value,
                    manufacturer:document.getElementById("manufacturer").value,
                    model:document.getElementById("model").value,
                    os:document.getElementById("os").value,
                    phone:document.getElementById("phone").value,
                    seriel:document.getElementById("seriel").value,
                    server:document.getElementById("server").value,
                    status:document.getElementById("status").value,
                    type:document.getElementById("type").value
                }
            }

            function clearFormData(){
                document.getElementById("client").value="";
                    document.getElementById("date").value="";
                    document.getElementById("ip").value="";
                    document.getElementById("location").value="";
                    document.getElementById("manufacturer").value="";
                    document.getElementById("model").value="";
                    document.getElementById("os").value="";
                    document.getElementById("phone").value="";
                    document.getElementById("seriel").value="";
                    document.getElementById("server").value="";
                    document.getElementById("status").value="";
                    document.getElementById("type").value="";

            }
            function setFormData(client,date,ip,location,manufacturer,model,os,phone,seriel,server,status,type){
                document.getElementById("client").value=client;
                    document.getElementById("date").value=date;
                    document.getElementById("ip").value=ip;
                    document.getElementById("location").value=location;
                    document.getElementById("manufacturer").value=manufacturer;
                    document.getElementById("model").value=model;
                    document.getElementById("os").value=os;
                    document.getElementById("phone").value=phone;
                    document.getElementById("seriel").value=seriel;
                    document.getElementById("server").value=server;
                    document.getElementById("status").value=status;
                    document.getElementById("type").value=type;


            }
            function editDataCall(id){
                console.log(id)
                fetch("http://localhost:8080/api/getmobiles?id="+id,{
                    method:"GET",
                }).then((res)=>res.json()).then((response)=>{
                    console.log(id)
                    console.log("Edit info",response)
                    for(i=0;i<response.length;i++){
                        // console.log("control inside forloop", response[i])
                        // console.log()
                        if(response[i].id == id) {
                            editFormData = response[i];
                        }
                        
                    }
                    
                    setFormData(editFormData.client,editFormData.date,editFormData.ip,editFormData.location,editFormData.manufacturer,editFormData.model,editFormData.os,editFormData.phone,editFormData.seriel,editFormData.server,editFormData.status,editFormData.type)
                })
            }
            function submitForm(){
                if(!editFormData) addMobile();
                else editData();
            }
            /*function setSuccessMessage(message) {
    document.getElementById("message").innerHTML = message;

}*/

function editData(){
            var formData=getFormData();
            formData['id'] = editFormData.id;
            fetch("http://localhost:8080/api/updatemobiles?id="+ formData['id'],{
                method:"PUT",
                mode:"cors",
                headers:{
                    "Content-Type":"application/json"
                },
                body:JSON.stringify(formData)
            }).then((res)=>res.json()).then((response)=>{
                //setSuccessMessage(response.message)
                clearFormData();
                getData();

            })

          }

            //add Mobiles
           function addMobile(){
            let payload = getFormData();
            /*payload['client']=document.getElementById("client").value;
            payload['date']=document.getElementById("date").value;
            payload['ip']=document.getElementById("ip").value;
            payload['location']=document.getElementById("location").value;
            payload['manufacturer']=document.getElementById("manufacturer").value;
            payload['model']=document.getElementById("model").value;
            payload['os']=document.getElementById("os").value;
            payload['phone']=document.getElementById("phone").value;
            payload['seriel']=document.getElementById("seriel").value;
            payload['server']=document.getElementById("server").value;
            payload['status']=document.getElementById("status").value;
            payload['type']=document.getElementById("type").value;*/

            fetch("http://localhost:8080/api/addmobiles",{
                method:"POST",
                mode:"cors",
                headers:{
                    "Content-Type":"application/json"
                },
                body:JSON.stringify(payload)
            }).then((res)=>res.json()).then((response)=>{
                setSuccessMessage(response.message)
                /*document.getElementById("message").innerHTML = response.message
                document.getElementById("client").value = "";
                document.getElementById("date").value="";
                document.getElementById("ip").value="";
                document.getElementById("location").value="";
                document.getElementById("manufacturer").value="";
                document.getElementById("model").value="";
                document.getElementById("os").value="";
                document.getElementById("phone").value="";
                document.getElementById("seriel").value="";
                document.getElementById("server").value="";
                document.getElementById("status").value="";
                document.getElementById("type").value="";*/

                clearFormData();


                getData();
            })
            

          } 
            //get all mobiles
            function getData(){
                fetch("http://localhost:8080/api/getmobiles").then(
                    (res)=>res.json()
                ).then((response)=>{
                    var tmpData="";
                    console.log(response);
                    Array.from(response).forEach(element => {
                        tmpData+="<tr>"
                        tmpData+="<td>"+element.id+"</td>";
                        tmpData+="<td>"+element.client+"</td>";
                        tmpData+="<td>"+element.date+"</td>";
                        tmpData+="<td>"+element.ip+"</td>";
                        tmpData+="<td>"+element.location+"</td>";
                        tmpData+="<td>"+element.manufacturer+"</td>";
                        tmpData+="<td>"+element.model+"</td>";
                        tmpData+="<td>"+element.os+"</td>";
                        tmpData+="<td>"+element.phone+"</td>";
                        tmpData+="<td>"+element.seriel+"</td>";
                        tmpData+="<td>"+element.server+"</td>";
                        tmpData+="<td>"+element.status+"</td>";
                        tmpData+="<td>"+element.type+"</td>";
                        
                        tmpData+="<td><button class='btn btn-primary' onclick='editDataCall(`"+element.id+"`)'>Edit</button></td>";
                        tmpData+="<td><button class='btn btn-danger' onclick='deleteData(`"+element.id+"`);myFunction();'>Delete</button></td>";
                       
                        tmpData+="</tr>";

                    });
                    document.getElementById("tbData").innerHTML=tmpData;
                })
            }
            getData();
            
            //delete mobile
            function deleteData(id){
                fetch("http://localhost:8080/api/deletemobiles/"+id,{
                    method:"DELETE",
                }).then((res)=>res.json()).then(
                    (response)=>{
                        //setSuccessMessage(response.message);
                        getData();
                    }
                )
            }

            //function myFunction() {
  //alert("Deleted Successfully !");
//}
        </script>
    </body>
</html>